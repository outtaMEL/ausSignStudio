# 使用指南

## 快速开始

```bash
cd sign-engine-sandbox
npm run demo
```

## 验收 SVG

### 方式 A：直接打开 SVG（最简单）

1. 找到生成的 `out.svg` 文件
2. 双击或拖到浏览器中打开

### 方式 B：使用预览页面（推荐）

```bash
# 用浏览器打开
playground/view.html
```

预览页面提供了深色背景，更容易观察边缘和对齐情况。

## 修改参数

编辑 `input.json` 来改变输出：

```json
{
  "templateCode": "G1-1",
  "input": {
    "destinationName": "Mary Hill",  // 修改目的地名称
    "distanceKm": "12",               // 修改距离
    "arrow": "arrow-right-std"
  },
  "pxPerH": 10  // 修改这个值来缩放整体尺寸
}
```

修改后重新运行：
```bash
npm run demo
```

### 使用不同的箭头放置策略

快速测试预设模板：

```bash
# 左箭头
cp input-left.json input.json && npm run demo

# 对齐第二行基线
cp input-baseline2.json input.json && npm run demo

# 光学下沉
cp input-optical.json input.json && npm run demo

# 或者一次测试所有策略
npm test
```

可用模板：
- `G1-1` - 右箭头 + 几何居中（默认）
- `G1-1-left` - 左箭头 + 几何居中
- `G1-1-baseline2` - 右箭头 + 对齐第二行基线
- `G1-1-optical` - 右箭头 + 光学下沉

详见：[箭头放置策略文档](./ARROW_PLACEMENT.md)

## 验收清单

运行后检查 `out.svg`，确认以下内容：

- ✅ **两行文字** "Mary Hill" 和 "12" 垂直排列
- ✅ **行间距** = 0.75h（默认 7.5px）
- ✅ **右箭头** 与文字组水平距离 = 1.0h（默认 10px）
- ✅ **箭头垂直居中** 对齐文字组
- ✅ **板面边距** 四周 = 1.0h（默认 10px）
- ✅ **边缘清晰** 像素对齐，不模糊

## 预期视觉效果

```
┌─────────────────────────────────────────────────┐
│                                                 │  ← 边距 1.0h
│  Mary Hill                            →        │
│              ↑ 行距 0.75h                      │
│  12                                   ↑         │
│                    ↑                           │
│              文字组 ← 组间距 1.0h → 箭头        │
│                                                 │
└─────────────────────────────────────────────────┘
   ← 边距 1.0h                       边距 1.0h →
```

## 实验不同的 pxPerH

尝试修改 `input.json` 中的 `pxPerH` 值：

- `pxPerH: 5` → 更小的标牌
- `pxPerH: 10` → 默认大小
- `pxPerH: 15` → 更大的标牌
- `pxPerH: 20` → 大型标牌

相对间距和比例应保持一致！

## 布局元数据

运行脚本时会输出详细的布局元数据：

```
📊 布局元数据:
  pxPerH: 10
  字母高度: 8h = 80px
  行间距: 0.75h = 7.5px
  组间距: 1h = 10px
  板边距: 1h = 10px
  文字组尺寸: 43.20h × 16.75h
              432.0px × 167.5px
  内容尺寸: 54.20h × 16.75h
            542.0px × 167.5px
  板面尺寸: 56.20h × 18.75h
            562.0px × 187.5px
```

这些数据可以用来验证布局计算的正确性。

## 架构说明

### D1: h 空间排版原语
- 纯函数，所有计算在抽象的 h 单位中完成
- 文件：`d1/box.js`, `d1/primitives.js`

### D2: 几何转换器
- 将文字和图标转换为 h 空间的 Box
- Mock 数据：`d2/fonts.json`, `d2/icons.json`
- 文件：`d2/converter.js`

### D3: G1-1 模板布局
- 实现"两行文字 + 右箭头"的布局策略
- 模板配置：`d3/templates.json`
- 文件：`d3/layout-g11.js`

### D4: SVG 渲染器
- 将布局模型转换为 SVG 标记
- 文件：`d4/svg.js`

## 关键设计决策

1. **h 单位抽象**：所有排版计算在 h 空间完成，仅在输出时转换为像素
2. **像素对齐**：使用 `snapToPixel` 确保边缘清晰（对齐到 0.5px）
3. **纯函数设计**：D1 原语都是纯函数，易于测试和组合
4. **基线对齐**：文字使用基线定位，确保排版准确
5. **垂直居中**：箭头相对于文字组的垂直中线居中

## 下一步扩展

如果要扩展功能，可以考虑：

- 添加更多模板（G1-2, G2-1 等）
- 支持更多字体系列
- 添加更多图标
- 实现文字换行
- 支持多种颜色方案
- 添加单元测试

所有扩展都应保持 D1-D4 的分层架构！

